---
title: "EvoCore: Charlesworth 2009"
author: "Brian O'Meara"
format:
  revealjs: 
    theme: dark
    incremental: true   
editor: visual
---

## Reading on $N_E$

Charlesworth, B. Effective population size and patterns of molecular evolution and variation. *Nat Rev Genet* **10**, 195--205 (2009). <https://doi.org/10.1038/nrg2526>.

Images from that paper unless otherwise noted.

## Common $N_E$

![Empirical estimates of effective population size](images/table1.png){fig-alt="Table 1 from Charlesworth 2009, showing empirical estimates of effective population size" fig-align="left"}

-   Why do they differ so much?

-   Why might this matter?

## Offspring count

Imagine a large population. I pick an individual at random to reproduce, then put it back. Then I pick at random again: perhaps the same one, maybe a different one. I stop when I have the same number of offspring as in the initial population. What are the number of offspring each parent could have?

```{r}
hist(rpois(n=10000, lambda=1), breaks=seq(from=-0.5, by=1, to=7.5))
```

## Coalescent processes

```{r}
library(ggplot2)
library(learnPopGen)
par(mfcol=c(1,3))
for (i in sequence(3)) {
	learnPopGen::coalescent.plot(n=5*i) 
}
```

## Selection

```{r, echo=TRUE}

Ne=500
p0=1/Ne
s=0.05
par(mfcol=c(1,1))
learnPopGen::drift.selection(w=c(1+s, 1, 1-s), Ne=Ne, p0=p0)
```

## Q from the paper

```{r, echo=TRUE}
Q_estimate <- function(Ne, s) {
	# Let N = Ne
	N <- Ne
	Q <- (Ne * s / N ) / (1 - exp(-2*Ne*s))
	return(Q)
}
```

## Now try a bunch of values

```{r, echo=TRUE}
s <- seq(from=-0.1, to=0.1, length.out=500)
Ne <- c(1e1, 25, 50, 1e2, 500)
results <- data.frame()
for (s_value in s) {
	for (Ne_value in Ne) {
		Q <- Q_estimate(Ne_value, s_value)
		results <- rbind(results, data.frame(Ne=Ne_value, s=s_value, Q=Q, lambda=Q*2*Ne_value ))		
	}
}
```

## Plot results

First, in terms of lambda (fixation probability as a multiple of the fixation probability of a neutral allele)


```{r, echo=TRUE}
results$Ne <- as.factor(results$Ne)
results_truncated <- subset(results, abs(results$s)<= 0.01)
ggplot(results_truncated, aes(x=s, y=lambda, group=Ne)) + geom_line(aes(color=Ne)) 
```

## Q plots

Plots of Q, the fixation probability. Note that this is for a wider variety of selection values than above.

```{r, echo=TRUE}
ggplot(results, aes(x=s, y=Q, group=Ne)) + geom_line(aes(color=Ne))
```
